# influxdb_read_write_config.yaml - InfluxDB 读写配置
# 本配置文件定义了数据读取策略和写入策略

# ==================== 读取配置 ====================
read:
  # 全局默认配置
  default:
    # 数据量选择模式: "time_range" 或 "last_n_points"
    mode: "time_range"

    # time_range 模式参数
    time_range:
      duration: 1  # 时间范围(数值)
      unit: "h"    # 时间单位: "h"(小时), "m"(分钟), "d"(天)

    # last_n_points 模式参数
    last_n_points:
      count: 100   # 读取最近N条数据

    # 默认 field_key
    default_field_key: "value"

    # 时间排序方式: "asc"(升序) 或 "desc"(降序)
    # asc: 从旧到新排序（升序，时间戳小的在前面）, desc: 从新到旧排序（降序，时间戳大的在前面）
    time_order: "desc"

    # 是否包含不可用设备/机房的数据（默认 false）
    # true: 包含不可用设备/机房的数据（用于诊断）, false: 只包含可用设备/机房的数据
    include_unavailable: false

  # ==================== 配置驱动的数据读取配置项 ====================
  # 以下配置项用于 read_influxdb_data(config_key) 方法
  # 每个配置项定义了一种数据读取策略，可以灵活组合不同的读取方法和参数

  # 示例配置 1: 读取数据中心最新状态（所有可观测数据）
  datacenter_latest_status:
    # 必填：读取方法类型
    # 可选值: read_all_observable_data / read_room_data / read_device_data / read_specific_uids
    read_method: "read_all_observable_data"

    # 可选：是否包含不可用设备/机房的数据（默认 false）
    include_unavailable: false

    # 可选：覆盖默认的读取模式配置（如果不指定则使用 default 配置）
    # mode: "time_range"
    # time_range:
    #   duration: 2
    #   unit: "h"

  # 示例配置 2: 读取预测结果（指定机房）
  prediction_result:
    read_method: "read_room_data"

    # 必填（当 read_method 为 read_room_data 时）：指定要读取的机房 UID 列表
    room_uids: [ "CR_A1" ]

    include_unavailable: false

    # 覆盖默认配置：使用最近 N 条数据模式
    mode: "last_n_points"
    last_n_points:
      count: 50

  # 示例配置 3: 读取关键设备数据
  critical_devices_data:
    read_method: "read_device_data"

    # 必填（当 read_method 为 read_device_data 时）：指定要读取的设备 UID 列表
    device_uids: [ "AC_A1_001", "AC_A1_002" ]

    # 覆盖默认配置：读取最近 2 小时的数据
    mode: "time_range"
    time_range:
      duration: 2
      unit: "h"

  # 示例配置 4: 读取特定测点数据
  specific_sensors_data:
    read_method: "read_specific_uids"

    # 必填（当 read_method 为 read_specific_uids 时）：指定要读取的属性 UID 列表
    specific_uids: [ "ac_a1_001_supply_temp", "ac_a1_001_return_temp","comp_a1_001_power" ]

    # 覆盖默认配置：使用最近 100 条数据
    mode: "last_n_points"
    last_n_points:
      count: 100

  # 示例配置 5: 读取多个机房的历史数据
  multi_room_history:
    read_method: "read_room_data"
    room_uids: [ "CR_A1", "CR_B2" ]
    include_unavailable: false

    # 读取最近 24 小时的数据
    mode: "time_range"
    time_range:
      duration: 24
      unit: "h"

  # 示例配置 6: 诊断模式（包含不可用设备）
  diagnostic_all_data:
    read_method: "read_all_observable_data"
    include_unavailable: true  # 包含不可用设备的数据，用于诊断

    mode: "time_range"
    time_range:
      duration: 1
      unit: "h"


# ==================== 写入配置 ====================
write:
  # 预测数据写入配置
  prediction:
    enabled: true
    database: "iot_origin_prediction"  # 目标数据库

    # 写入策略
    batch_size: 100  # 批量写入大小
    retry_times: 3   # 写入失败重试次数
    retry_interval: 2  # 重试间隔(秒)

    # 数据保留策略(可选)
    retention_policy: "autogen"  # InfluxDB retention policy

    # 写入的数据类型
    data_types:
      # 温度预测
      - data_type: "temperature_prediction"
        enabled: true
        description: "机房温度预测数据"
        # measurement 命名规则: {room_uid}_temp_pred_{horizon}
        # 例如: CR_A1_temp_pred_1h, CR_A1_temp_pred_6h

      # 能耗预测
      - data_type: "energy_prediction"
        enabled: true
        description: "机房能耗预测数据"
        # measurement 命名规则: {room_uid}_energy_pred_{horizon}

      # PUE预测
      - data_type: "pue_prediction"
        enabled: true
        description: "数据中心PUE预测数据"
        # measurement 命名规则: dc_pue_pred_{horizon}

  # 优化控制指令写入配置
  optimization:
    enabled: true
    database: "iot_origin_optimization"

    batch_size: 50
    retry_times: 3
    retry_interval: 2
    retention_policy: "autogen"

    # 控制指令类型
    control_types:
      # 空调控制指令
      - control_type: "ac_control"
        enabled: true
        description: "空调控制指令"
        # measurement 命名规则: 使用设备的控制属性 uid
        # 例如: ac_a1_001_on_setpoint, ac_a1_001_supply_temp_setpoint

      # 压缩机控制指令
      - control_type: "compressor_control"
        enabled: true
        description: "压缩机控制指令"

      # 冷水机组控制指令
      - control_type: "chiller_control"
        enabled: true
        description: "冷水机组控制指令"

      # 水泵控制指令
      - control_type: "pump_control"
        enabled: true
        description: "水泵控制指令"

      # 冷却塔控制指令
      - control_type: "cooling_tower_control"
        enabled: true
        description: "冷却塔控制指令"

# ==================== 查询优化配置 ====================
query_optimization:

  # 是否启用并行查询(对于大量 uid 的情况)
  enable_parallel_query: true

  # 并行查询的线程数
  parallel_threads: 4

  # 单次查询的最大 uid 数量(超过则分批查询)
  max_uids_per_query: 200
