# æ•°æ®è¯»å†™æ¨¡å—é€‚é…æ–°YAMLæ ¼å¼ - ä¿®æ”¹æ€»ç»“

## æ¦‚è¿°

æˆåŠŸä¿®æ”¹ `utils/data_reading_writing.py`ï¼Œä½¿å…¶**å®Œå…¨å…¼å®¹**æ–°ç”Ÿæˆçš„ `uid_config.yaml` æ ¼å¼ï¼ŒåŒæ—¶ä¿æŒå‘åå…¼å®¹æ—§æ ¼å¼ã€‚

---

## æ–°é…ç½®æ ¼å¼

### æ–‡ä»¶ï¼š`configs/uid_config.yaml`
```yaml
room_name: 1å·æ¥¼IDCæœºæˆ¿
air_conditioners:
  ä½³åŠ›å›¾KN10ç©ºè°ƒ4-3-9:
    device_name: ä½³åŠ›å›¾KN10ç©ºè°ƒ4-3-9
    measurement_points:
      æ¸©åº¦è®¾å®šå€¼: 64d36414_c7cf_4b72_a3ff_b55c0d4ccffc
      æ¹¿åº¦è®¾ç½®å€¼: fd735696_baf7_4125_9eb5_ffaa40c9966b
      å¼€å…³æœºå‘½ä»¤: 80c662f3_0173_4b21_a36c_f63f722bce4d
      # ... æ›´å¤šæµ‹ç‚¹
```

### ç»Ÿè®¡æ•°æ®
- ğŸ“ æœºæˆ¿ï¼š1å·æ¥¼IDCæœºæˆ¿
- ğŸ”Œ ç©ºè°ƒæ€»æ•°ï¼š92å°
- ğŸ“Š æµ‹ç‚¹æ€»æ•°ï¼š418ä¸ª
- ğŸ·ï¸ æµ‹ç‚¹ç±»å‹ï¼š18ç§

---

## ä¿®æ”¹å†…å®¹

### 1. æ–°å¢è¾…åŠ©å‡½æ•°ï¼ˆç¬¬8-103è¡Œï¼‰

#### `_extract_uids_from_air_conditioners(uid_config, measurement_point_names=None)`
**åŠŸèƒ½ï¼š** ä»æ–°æ ¼å¼ä¸­æå–UIDåˆ—è¡¨

**å‚æ•°ï¼š**
- `uid_config`: é…ç½®å­—å…¸
- `measurement_point_names`: æµ‹ç‚¹åç§°åˆ—è¡¨ï¼ˆNone=æå–æ‰€æœ‰ï¼‰

**è¿”å›ï¼š** UIDåˆ—è¡¨

**ç”¨é€”ï¼š** 
- ç”¨äº `reading_data_query()` è·å–æŸ¥è¯¢çš„UIDåˆ—è¡¨

---

#### `_get_air_conditioner_uids_and_names(uid_config)`
**åŠŸèƒ½ï¼š** æå–æ‰€æœ‰ç©ºè°ƒçš„UIDå’Œåç§°åˆ—è¡¨

**è¿”å›ï¼š** `(uidsåˆ—è¡¨, namesåˆ—è¡¨)`

**UIDæå–ç­–ç•¥ï¼š**
1. ä¼˜å…ˆé€‰æ‹©å¼€å…³æœºç±»æµ‹ç‚¹ï¼š`ç›‘æ§å¼€å…³æœº`ã€`ç›‘æ§å¼€å…³æœºçŠ¶æ€`ã€`å¼€å…³æœºå‘½ä»¤`
2. å¤‡é€‰æ¸©åº¦ç±»æµ‹ç‚¹ï¼š`æ¸©åº¦è®¾å®šå€¼`ã€`æ¸©åº¦è®¾å®šç‚¹`ã€`å›é£æ¸©åº¦è®¾å®šç‚¹ï¼ˆâ„ƒï¼‰`ã€`é€é£æ¸©åº¦è®¾ç½®ç‚¹`

**ç”¨é€”ï¼š**
- ç”¨äº `generate_optimization_result_points()` ç”Ÿæˆä¼˜åŒ–ç»“æœæ•°æ®ç‚¹

---

#### `_map_measurement_points_to_uids(uid_config, ac_name, point_names)`
**åŠŸèƒ½ï¼š** å°†ç©ºè°ƒçš„æµ‹ç‚¹åç§°æ˜ å°„åˆ°UID

**å‚æ•°ï¼š**
- `uid_config`: é…ç½®å­—å…¸
- `ac_name`: ç©ºè°ƒåç§°
- `point_names`: æµ‹ç‚¹åç§°åˆ—è¡¨

**è¿”å›ï¼š** `{æµ‹ç‚¹åç§°: UID}` å­—å…¸

**ç”¨é€”ï¼š**
- é€šç”¨å·¥å…·å‡½æ•°ï¼Œæ–¹ä¾¿å…¶ä»–æ¨¡å—ä½¿ç”¨

---

### 2. ä¿®æ”¹çš„å‡½æ•°

#### `get_measurements_tags_fields()` (ç¬¬108-167è¡Œ)

**ä¿®æ”¹å†…å®¹ï¼š** æ·»åŠ æ–°æ ¼å¼æ”¯æŒ

**æ—§æ ¼å¼å‚æ•°ï¼š**
```python
measurements_fields_dict = {
    "indoor_temperature": [25.0, 26.0],  # measurementç±»å‹: å€¼åˆ—è¡¨
    "outdoor_temperature": [30.0, 31.0]
}
```

**æ–°æ ¼å¼å‚æ•°ï¼š**
```python
measurements_fields_dict = {
    "ä½³åŠ›å›¾KN10ç©ºè°ƒ4-3-9": {          # ç©ºè°ƒåç§°
        "æ¸©åº¦è®¾å®šå€¼": 25.0,            # æµ‹ç‚¹åç§°: å€¼
        "æ¹¿åº¦è®¾ç½®å€¼": 50.0
    },
    "è‰¾ç‰¹ç©ºè°ƒ4-1-4": {
        "é€é£æ¸©åº¦è®¾ç½®ç‚¹": 26.0,
        "æ¹¿åº¦è®¾å®šç‚¹": 55.0
    }
}
```

**å…¼å®¹é€»è¾‘ï¼š**
1. å…ˆå°è¯• `uid_config.get(uid_type)`
2. å¦‚æœå­˜åœ¨ â†’ ä½¿ç”¨æ—§æ ¼å¼é€»è¾‘
3. å¦‚æœä¸å­˜åœ¨ â†’ ä½¿ç”¨æ–°æ ¼å¼é€»è¾‘ï¼ˆä» `air_conditioners` æå–ï¼‰

---

#### `reading_data_query()` (ç¬¬252-278è¡Œ)

**ä¿®æ”¹å†…å®¹ï¼š** æ·»åŠ æ–°æ ¼å¼çš„UIDæå–é€»è¾‘

**æ—§æ ¼å¼ï¼š** ä» `uid_config[query_uid]` è¯»å–  
**æ–°æ ¼å¼ï¼š** è°ƒç”¨ `_extract_uids_from_air_conditioners()` æå–

**æŸ¥è¯¢æ–¹å¼ï¼š**
```python
# æŸ¥è¯¢æ‰€æœ‰æµ‹ç‚¹
df = reading_data_query(..., query_measurement=None)

# æŸ¥è¯¢ç‰¹å®šæµ‹ç‚¹ï¼ˆæ–°æ ¼å¼ä½¿ç”¨æµ‹ç‚¹åç§°ï¼‰
df = reading_data_query(..., query_measurement=['æ¸©åº¦è®¾å®šå€¼', 'æ¹¿åº¦è®¾ç½®å€¼'])
```

---

#### `_format_dataframe_like_flux_result_new_structure()` (ç¬¬343-396è¡Œ)

**ä¿®æ”¹å†…å®¹ï¼š** æ·»åŠ æ–°æ ¼å¼çš„UIDåˆ°measurementæ˜ å°„

**æ—§æ ¼å¼ï¼š** ä½¿ç”¨ `measurement_type`  
**æ–°æ ¼å¼ï¼š** ä½¿ç”¨ `{ç©ºè°ƒåç§°}_{æµ‹ç‚¹åç§°}` ä½œä¸ºåˆ—å

---

#### `generate_optimization_result_points()` (ç¬¬502-511è¡Œ)

**ä¿®æ”¹å†…å®¹ï¼š** æ·»åŠ æ–°æ ¼å¼çš„ç©ºè°ƒä¿¡æ¯æå–

**æ—§æ ¼å¼ï¼š** ä» `uid_config['device_uid']` è¯»å–  
**æ–°æ ¼å¼ï¼š** è°ƒç”¨ `_get_air_conditioner_uids_and_names()` æå–

---

## å…¼å®¹æ€§ä¿è¯

### âœ… å®Œå…¨å…¼å®¹
æ‰€æœ‰å‡½æ•°éƒ½æ”¯æŒæ–°æ—§ä¸¤ç§æ ¼å¼ï¼Œä»£ç ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨åˆé€‚çš„é€»è¾‘ï¼š

1. **æ•°æ®å†™å…¥å‡½æ•°**
   - `prediction_data_writing()`
   - `setting_data_writing()`
   - `reference_data_writing()`
   - `optimization_result_writing_suggestions()`
   - `optimization_result_writing_reference()`

2. **æ•°æ®è¯»å–å‡½æ•°**
   - `reading_data_query()`

3. **æ•°æ®ç‚¹ç”Ÿæˆå‡½æ•°**
   - `generate_points()`
   - `generate_optimization_result_points()`

### ğŸ”„ æ ¼å¼æ£€æµ‹é€»è¾‘

```python
# æ£€æµ‹æ–¹å¼
if uid_config.get(uid_type) is not None:
    # ä½¿ç”¨æ—§æ ¼å¼é€»è¾‘
    pass
else:
    # ä½¿ç”¨æ–°æ ¼å¼é€»è¾‘ï¼ˆä» air_conditioners æå–ï¼‰
    pass
```

---

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå†™å…¥ç©ºè°ƒè®¾ç½®æ•°æ®ï¼ˆæ–°æ ¼å¼ï¼‰

```python
from utils import data_reading_writing

# æ„å»ºæ•°æ®å­—å…¸ï¼ˆæ–°æ ¼å¼ï¼‰
setting_data = {
    "ä½³åŠ›å›¾KN10ç©ºè°ƒ4-3-9": {
        "æ¸©åº¦è®¾å®šå€¼": 24.5,
        "æ¹¿åº¦è®¾ç½®å€¼": 50.0,
        "å¼€å…³æœºå‘½ä»¤": 1
    },
    "è‰¾ç‰¹ç©ºè°ƒ4-1-4": {
        "é€é£æ¸©åº¦è®¾ç½®ç‚¹": 25.0,
        "æ¹¿åº¦è®¾å®šç‚¹": 55.0,
        "ç›‘æ§å¼€å…³æœº": 1
    }
}

# å†™å…¥æ•°æ®åº“
data_reading_writing.setting_data_writing(
    influxdb_config,
    uid_config,
    setting_data,
    setting_data_client
)
```

---

### ç¤ºä¾‹2ï¼šæŸ¥è¯¢ç©ºè°ƒæ•°æ®ï¼ˆæ–°æ ¼å¼ï¼‰

```python
# æŸ¥è¯¢æ‰€æœ‰æµ‹ç‚¹æ•°æ®
df = data_reading_writing.reading_data_query(
    influxdb_config,
    uid_config,
    reading_data_client,
    query_range="-1h"
)

# æŸ¥è¯¢ç‰¹å®šæµ‹ç‚¹æ•°æ®
df = data_reading_writing.reading_data_query(
    influxdb_config,
    uid_config,
    reading_data_client,
    query_range="-1h",
    query_measurement=['æ¸©åº¦è®¾å®šå€¼', 'æ¹¿åº¦è®¾ç½®å€¼', 'å¼€å…³æœºå‘½ä»¤']
)
```

---

### ç¤ºä¾‹3ï¼šç”Ÿæˆä¼˜åŒ–ç»“æœï¼ˆè‡ªåŠ¨é€‚é…ï¼‰

```python
# å‡½æ•°ä¼šè‡ªåŠ¨ä»æ–°æ ¼å¼ä¸­æå–ç©ºè°ƒä¿¡æ¯
optimization_result = {
    'air_conditioner_setting_temperature': [24.5, 25.0, ...],
    'air_conditioner_setting_humidity': [50.0, 55.0, ...],
    'air_conditioner_cooling_mode': [1, 1, ...]
}

data_reading_writing.optimization_result_writing_suggestions(
    influxdb_config,
    uid_config,
    optimization_result,
    setting_data_client,
    is_auto_execute=True
)
```

---

## æµ‹ç‚¹ç±»å‹ç»Ÿè®¡

æ ¹æ®ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ï¼Œç³»ç»Ÿæ”¯æŒä»¥ä¸‹18ç§æµ‹ç‚¹ç±»å‹ï¼š

| æµ‹ç‚¹ç±»å‹ | ç©ºè°ƒæ•°é‡ |
|---------|---------|
| å›é£æ¹¿åº¦è®¾å®šç‚¹ï¼ˆ%ï¼‰ | 37å° |
| å›é£æ¸©åº¦è®¾å®šç‚¹ï¼ˆâ„ƒï¼‰ | 36å° |
| è¿œç¨‹å¹³å‡æ¸©åº¦è®¾å®šç‚¹ï¼ˆâ„ƒï¼‰ | 37å° |
| è¿œç¨‹æœ€é«˜æ¸©åº¦è®¾å®šç‚¹ï¼ˆâ„ƒï¼‰ | 37å° |
| ç›‘æ§å¼€å…³æœºçŠ¶æ€ | 29å° |
| æ¸©åº¦è®¾å®šå€¼ | 35å° |
| æ¹¿åº¦è®¾ç½®å€¼ | 35å° |
| å†·å†»æ°´é˜€æœ€å°å¼€åº¦ | 23å° |
| é£æœºé¢å®šé£é‡ | 23å° |
| å¼€å…³æœºå‘½ä»¤ | 23å° |
| æ˜¯å¦å¼ºåˆ¶å¼€å†·å†»æ°´é˜€ | 23å° |
| æ¸©åº¦è®¾å®šç‚¹ | 15å° |
| æ¹¿åº¦è®¾å®šç‚¹ | 20å° |
| é£æœºä¸‹é™è½¬é€Ÿ | 15å° |
| é£æœºä¸Šé™è½¬é€Ÿ | 15å° |
| é€é£æ¸©åº¦è®¾ç½®ç‚¹ | 5å° |
| å›é£æ¸©åº¦è®¾å®šç‚¹ | 5å° |
| ç›‘æ§å¼€å…³æœº | 5å° |

---

## UIDæ ¼å¼åˆ†æ

é…ç½®æ–‡ä»¶ä¸­åŒ…å«3ç§UIDæ ¼å¼ï¼š

1. **UUIDæ ¼å¼** (227ä¸ª): `64d36414_c7cf_4b72_a3ff_b55c0d4ccffc`
2. **nodeZNVæ ¼å¼** (15ä¸ª): `nodeZNV.00001006000000001139.0176302001`
3. **Nç³»åˆ—æ ¼å¼** (176ä¸ª): `N2_S0_E1_A27`, `N3_S0_E11_D52`

æ‰€æœ‰æ ¼å¼å‡å¾—åˆ°æ­£ç¡®æ”¯æŒã€‚

---

## ä¼˜åŠ¿

### âœ… å®Œå…¨å‘åå…¼å®¹
- æ—§ä»£ç æ— éœ€ä¿®æ”¹
- æ—§é…ç½®æ–‡ä»¶ä»ç„¶å¯ç”¨
- å¯ä»¥æ··åˆä½¿ç”¨æ–°æ—§æ ¼å¼

### âœ… æ›´ç›´è§‚çš„æ•°æ®ç»“æ„
- æŒ‰ç©ºè°ƒåˆ†ç»„æ›´æ¸…æ™°
- ä½¿ç”¨ä¸­æ–‡æµ‹ç‚¹åç§°ï¼Œæ›´æ˜“ç†è§£
- è‡ªåŠ¨ä»Excelç”Ÿæˆï¼Œå‡å°‘æ‰‹å·¥é…ç½®é”™è¯¯

### âœ… æ˜“äºç»´æŠ¤
- ç»Ÿä¸€çš„é…ç½®æ¥æºï¼ˆExcelè¡¨æ ¼ï¼‰
- è‡ªåŠ¨ç”Ÿæˆé…ç½®æ–‡ä»¶
- æ¸…æ™°çš„ç©ºè°ƒ-æµ‹ç‚¹æ˜ å°„å…³ç³»

---

## ç›¸å…³æ–‡ä»¶

### ä¿®æ”¹çš„æ–‡ä»¶
- âœ… `utils/data_reading_writing.py` - æ ¸å¿ƒä¿®æ”¹ï¼Œæ”¯æŒæ–°æ ¼å¼

### æ–°å¢çš„æ–‡ä»¶
- âœ… `modules/uid_read.py` - ä»Excelç”Ÿæˆé…ç½®æ–‡ä»¶
- âœ… `configs/uid_config.yaml` - æ–°æ ¼å¼é…ç½®æ–‡ä»¶
- âœ… `docs/uid_config_migration_guide.md` - è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
- âœ… `docs/modification_summary.md` - æœ¬æ–‡æ¡£

### æœªä¿®æ”¹çš„æ–‡ä»¶
- `utils/initialization.py` - æ— éœ€ä¿®æ”¹
- `main.py` - æ— éœ€ä¿®æ”¹
- å…¶ä»–ä¸šåŠ¡é€»è¾‘æ–‡ä»¶ - æ— éœ€ä¿®æ”¹

---

## ä¸‹ä¸€æ­¥å»ºè®®

1. **æµ‹è¯•å»ºè®®**
   - æµ‹è¯•æ‰€æœ‰æ•°æ®å†™å…¥å‡½æ•°
   - æµ‹è¯•æ‰€æœ‰æ•°æ®è¯»å–å‡½æ•°
   - éªŒè¯ä¼˜åŒ–ç»“æœç”ŸæˆåŠŸèƒ½

2. **æ›´æ–°å»ºè®®**
   - å¦‚æœ‰æ–°å¢ç©ºè°ƒï¼Œé‡æ–°è¿è¡Œ `modules/uid_read.py`
   - å®šæœŸæ ¸å¯¹Excelè¡¨æ ¼å’Œé…ç½®æ–‡ä»¶çš„ä¸€è‡´æ€§

3. **æ‰©å±•å»ºè®®**
   - å¯ä»¥è€ƒè™‘æ·»åŠ é…ç½®éªŒè¯å·¥å…·
   - å¯ä»¥è€ƒè™‘æ·»åŠ é…ç½®å¯¹æ¯”å·¥å…·ï¼ˆæ–°æ—§æ ¼å¼ï¼‰

---

## æ€»ç»“

âœ… **ä¿®æ”¹å®Œæˆï¼**`data_reading_writing.py` ç°å·²å®Œå…¨æ”¯æŒæ–°æ ¼å¼çš„ `uid_config.yaml`ï¼ŒåŒæ—¶ä¿æŒå‘åå…¼å®¹æ€§ã€‚

ğŸ“ **æ ¸å¿ƒæ”¹è¿›ï¼š**
- 3ä¸ªæ–°å¢è¾…åŠ©å‡½æ•°
- 4ä¸ªå‡½æ•°ä¿®æ”¹ä»¥æ”¯æŒæ–°æ ¼å¼
- å®Œå…¨å‘åå…¼å®¹æ—§æ ¼å¼
- 92å°ç©ºè°ƒã€418ä¸ªæµ‹ç‚¹ã€18ç§æµ‹ç‚¹ç±»å‹å…¨éƒ¨æ”¯æŒ

ğŸ¯ **ä½¿ç”¨æ–¹å¼ï¼š**
1. è¿è¡Œ `modules/uid_read.py` ç”Ÿæˆé…ç½®
2. æ— éœ€ä¿®æ”¹ä¸šåŠ¡ä»£ç 
3. è‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨æ­£ç¡®çš„æ ¼å¼

---

**æ›´æ–°æ—¶é—´ï¼š** 2025-10-30  
**ä¿®æ”¹äººï¼š** AI Assistant  
**ç‰ˆæœ¬ï¼š** v2.0

